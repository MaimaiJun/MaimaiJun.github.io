<!DOCTYPE html>

<html lang="zh-Hans">

<head>
  
  <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />
  <title>四足蜘蛛机器人 - 唛唛君</title>
  <meta charset="UTF-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

    <!-- Site Verification -->
    <meta name="baidu-site-verification" content="code-J1Qg17G6wT" />

  <link rel="shortcut icon" href="/images//background/head.jpg" type="image/png" />
  <meta name="description" content="🧡暑假小玩具的分享，ESP32作为主控的复刻🧡">
<meta property="og:type" content="article">
<meta property="og:title" content="四足蜘蛛机器人">
<meta property="og:url" content="http://example.com/2022/08/24/test/index.html">
<meta property="og:site_name" content="唛唛君">
<meta property="og:description" content="🧡暑假小玩具的分享，ESP32作为主控的复刻🧡">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/images/blogvip/2d801d02a07740a9b0b9334c9a3ea7fe.png">
<meta property="og:image" content="http://example.com/images/blogvip/ddc9041a55fd4a96830b26957d26a8c5.png">
<meta property="article:published_time" content="2022-08-24T12:05:55.000Z">
<meta property="article:modified_time" content="2022-08-24T14:15:07.108Z">
<meta property="article:author" content="Maimaijun">
<meta property="article:tag" content="单片机">
<meta property="article:tag" content="EPS32">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/blogvip/2d801d02a07740a9b0b9334c9a3ea7fe.png">
  <link rel="stylesheet" href="https://unpkg.com/highlight.js@9.15.8/styles/atom-one-dark.css" crossorigin>
  <link rel="stylesheet" href="/lib/mdui_043tiny/css/mdui.css">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css">
  <link rel="stylesheet" href="/lib/fancybox/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css">
  
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2421060_8z08qcz5sq3.css">
  
  <link rel="stylesheet" href="/css/style.css?v=1661351491267">
<meta name="generator" content="Hexo 6.2.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/background/xiang.jpg)"></div>
    <div class="nexmoe-small" style="background-image: url(/images/background/background.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Maimaijun" class="mdui-btn mdui-btn-icon"><img src="/images//background/head.jpg" alt="Maimaijun"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Maimaijun">
            <img src="/images//background/head.jpg" alt="Maimaijun" alt="Maimaijun">
        </a>
    </div>
    <div class="nexmoe-count">
        <div class="nexmoe-count-item"><span>文章</span>2 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>2<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>0<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-meishi"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-hanbao1"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于我">
            <i class="mdui-list-item-icon nexmoefont icon-jiubei1"></i>
            <div class="mdui-list-item-content">
                关于我
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friend.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-cola"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/download.html" title="下载中心">
            <i class="mdui-list-item-icon nexmoefont icon-tangguo"></i>
            <div class="mdui-list-item-content">
                下载中心
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  
<!-- 站内搜索 -->

<div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search" >
        <form id="search-form">
            <label><input type="text" id="local-search-input" name="q" results="0" placeholder="站内搜索" class="input form-control" autocomplete="off" autocorrect="off"/></label>
            <!-- 清空/重置搜索框 -->
            <i class="fa fa-times" onclick="resetSearch()"></i>
        </form>
    </div>
    <div id="local-search-result"></div> <!-- 搜索结果区 -->
    <!-- <p class='no-result'></p> 无匹配时显示，注意在 CSS 中设置默认隐藏 -->
</div>


  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://blog.csdn.net/qq_62096941" target="_blank" mdui-tooltip="{content: 'CSDN'}" style="color: rgb(199,29,35);background-color: rgba(199,29,35,.1);">
            <i class="nexmoefont icon-csdn"></i>
        </a><a class="mdui-ripple" href="https://github.com/MaimaiJun/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  

  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/EPS32/" style="font-size: 10px;">EPS32</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 10px;">单片机</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2022 Maimaijun
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/MaimaiJun" target="_blank">唛唛君</a><br/>
        <a href="http://beian.miit.gov.cn" target="_blank">尚未备案</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        
        
    </div>

</div><!-- .nexmoe-drawer -->

  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    
        <div class="nexmoe-post-cover" style="padding-bottom: 24.615384615384617%;">
            <img data-src="/images/blogvip/1.jpg" data-sizes="auto" alt="四足蜘蛛机器人" class="lazyload">
            <h1>四足蜘蛛机器人</h1>
        </div>
    

        <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2022年08月24日</a>
    <a><i class="nexmoefont icon-areachart"></i>4.8k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 28 分钟</a>
</div>

        <div class="nexmoe-post-right">
            
                <div class="nexmoe-fixed">
                    <div class="nexmoe-valign">
                        <div class="nexmoe-toc">
                            
                            
                                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D"><span class="toc-number">1.</span> <span class="toc-text">1️⃣前面的话</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3%E6%9D%90%E6%96%99%E6%B8%85%E5%8D%95"><span class="toc-number">2.</span> <span class="toc-text">2️⃣材料清单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3%E7%BB%84%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">3️⃣组装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86"><span class="toc-number">4.</span> <span class="toc-text">4️⃣代码部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">5️⃣总结</span></a></li></ol>
                            
                        </div>
                    </div>
                </div>
            
        </div>

        <article>
            <p>🧡暑假小玩具的分享，ESP32作为主控的复刻🧡</p>
<span id="more"></span>
<p>2022年  还有人在做四足蜘蛛机器人</p>
<h2 id="1️⃣前面的话"><a href="#1️⃣前面的话" class="headerlink" title="1️⃣前面的话"></a>1️⃣前面的话</h2><hr>
<p>🎈🎈🎈分享一个四足蜘蛛机器人，在b站刷视频的时候发现一个脑袋是大摄像头的蜘蛛机器人，于是开始收集资料自己造一个！<br>四足蜘蛛结构，每一步详细的安装过程都在下方大佬的链接有分享<br><a target="_blank" rel="noopener" href="https://www.instructables.com/DIY-Spider-RobotQuad-robot-Quadruped">https://www.instructables.com/DIY-Spider-RobotQuad-robot-Quadruped</a><br>本文主要用ESP32做主控，和tb上常见的硬件来复刻完成，主要控制代码参考github上开源的esp32蜘蛛机器人改进</p>
<h2 id="2️⃣材料清单"><a href="#2️⃣材料清单" class="headerlink" title="2️⃣材料清单"></a>2️⃣材料清单</h2><hr>
<table>
<thead>
<tr>
<th>ESP32-WROOM-32 开发板</th>
<th align="center">1</th>
<th align="right">22💴</th>
</tr>
</thead>
<tbody><tr>
<td><strong>16路舵机驱动板</strong></td>
<td align="center"><strong>1</strong></td>
<td align="right"><strong>20</strong></td>
</tr>
<tr>
<td><strong>sg90舵机</strong></td>
<td align="center"><strong>12</strong></td>
<td align="right"><strong>60</strong></td>
</tr>
<tr>
<td><strong>5v3a稳压模块</strong></td>
<td align="center"><strong>1</strong></td>
<td align="right"><strong>4</strong></td>
</tr>
<tr>
<td><strong>3d打印件</strong></td>
<td align="center"><strong>若干</strong></td>
<td align="right"><strong>60</strong></td>
</tr>
<tr>
<td><strong>12v电池</strong>（自用）</td>
<td align="center"><strong>1</strong></td>
<td align="right"><strong>20</strong></td>
</tr>
</tbody></table>
<h2 id="3️⃣组装"><a href="#3️⃣组装" class="headerlink" title="3️⃣组装"></a>3️⃣组装</h2><hr>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/images/blogvip/2d801d02a07740a9b0b9334c9a3ea7fe.png" alt="7796fd18f23fc3bb4e45c3584a01fb37.png" class="lazyload"><br>蜘蛛的身体和四条腿组装如上图所示⬆<br><strong>在原作者的博客里是先将每个舵机旋转至90°位置，再将卡扣安装上</strong></p>
<pre><code class="bash/">#include &lt;Servo.h&gt;   
Servo servo[4][3];
const int servo_pin[4][3] = &#123; &#123;2, 3, 4&#125;, &#123;5, 6, 7&#125;, &#123;8, 9, 10&#125;, &#123;11, 12, 13&#125; &#125;;
void setup()
&#123;
  for (int i = 0; i &lt; 4; i++)
  &#123;
    for (int j = 0; j &lt; 3; j++)
    &#123;
      servo[i][j].attach(servo_pin[i][j]);
      delay(20);
    &#125;&#125;&#125;
void loop(void)
&#123;
  for (int i = 0; i &lt; 4; i++)
  &#123;
    for (int j = 0; j &lt; 3; j++)
    &#123;
      servo[i][j].write(90);
      delay(20); &#125;&#125;&#125;     //原作者的方法
</code></pre>
<p>由于本人所用舵机是180度带限位的舵机，所以并没有通过程序将每个舵机旋转至90度，而是一条条腿调试😂<br><strong>本人的方案是，通过I2C将esp32与PCA9685进行通讯</strong></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/images/blogvip/ddc9041a55fd4a96830b26957d26a8c5.png" alt="54ce1f604c418a413e861fbb6a3b9d60.png" class="lazyload"></p>
<p>其中引脚21，22为自己定义，单片机的供电可以由PCA9685的V+连接到单片机的vin口，但在测试过程中，单片机的稳压模块温度会有所上升。🧡</p>
<hr>
<h2 id="4️⃣代码部分"><a href="#4️⃣代码部分" class="headerlink" title="4️⃣代码部分"></a>4️⃣代码部分</h2><p><strong>代码更改自github开源项目，因为用到esp32的蓝牙模块，所以会注释掉一些原代码的功能，如果需要这些功能的朋友们可以自行更改</strong><br>   <strong>区别</strong>：copy的项目代码运用了freertos的xSemaphoreTake，比普通的定时器运行效率更为高效<br>   <em><strong>下面是我更改的代码</strong></em>🔽<br>   <em>其中蓝牙通讯功能有bug，读取发送数据为1个字节读取，所以10-17号命令无效，因为勉强能用，所以未做更改</em>😁</p>
<hr>
<p><strong>🧡主目录</strong></p>
<pre><code>#include &lt;Arduino.h&gt;
#include &lt;C:\你的文件地址\servos.h&gt;
void setup() &#123;
    Serial.begin(115200);
    delay(1000);
    Serial.println(&quot;===== ROBOT SETUP =====&quot;);
    pinMode(LED_BUILTIN, OUTPUT);
    servos_init();
    Serial.println(&quot;===== SETUP END =====&quot;);
&#125;
void loop() &#123;
    servos_loop();
&#125;
</code></pre>
<p><strong>🧡子目录</strong></p>
<pre><code>
#include &lt;C:\你的文件地址\servos.h&gt;
#include &lt;BluetoothSerial.h&gt;


BluetoothSerial SerialBT; //Object for Bluetooth


Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();

/* Servos --------------------------------------------------------------------*/
//define 12 servos for 4 legs
//Servo servo[4][3];
//define servos&#39; ports
const int servo_pin[4][3] = &#123;&#123;0, 1, 2&#125;, &#123;4, 5, 6&#125;, &#123;8, 9, 10&#125;, &#123;12, 13, 14&#125;&#125;;
/* Size of the robot ---------------------------------------------------------*/
const float length_a = 55;
const float length_b = 77.5;
const float length_c = 27.5;
const float length_side = 71;
const float z_absolute = -28;
/* Constants for movement ----------------------------------------------------*/
const float z_default = -50, z_up = -30, z_boot = z_absolute;
const float x_default = 62, x_offset = 0;
const float y_start = 0, y_step = 40;
const float y_default = x_default;
/* variables for movement ----------------------------------------------------*/
typedef struct &#123;
    float site_now[4][3];     //real-time coordinates of the end of each leg
    float site_expect[4][3];  //expected coordinates of the end of each leg
    float temp_speed[4][3];   //each axis&#39; speed, needs to be recalculated before each movement
    int32_t FRFoot = 0;
    int32_t FRElbow = 0;
    int32_t FRShdr = 0;
    int32_t FLFoot = 0;
    int32_t FLElbow = 0;
    int32_t FLShdr = 0;
    int32_t RRFoot = 0;
    int32_t RRElbow = 0;
    int32_t RRShdr = 0;
    int32_t RLFoot = 0;
    int32_t RLElbow = 0;
    int32_t RLShdr = 0;
    int32_t rest_counter = 0;  //+1/0.02s, for automatic rest
&#125; service_status_t;

service_status_t sst;

float move_speed = 1.4;            //movement speed
float speed_multiple = 1;          //movement speed multiple
const float spot_turn_speed = 4;
const float leg_move_speed = 8;
const float body_move_speed = 3;
const float stand_seat_speed = 1;
//functions&#39; parameter
const float KEEP = 255;
//define PI for calculation
const float pi = 3.1415926;
/* Constants for turn --------------------------------------------------------*/
//temp length
const float temp_a = sqrt(pow(2 * x_default + length_side, 2) + pow(y_step, 2));
const float temp_b = 2 * (y_start + y_step) + length_side;
const float temp_c = sqrt(pow(2 * x_default + length_side, 2) + pow(2 * y_start + y_step + length_side, 2));
const float temp_alpha = acos((pow(temp_a, 2) + pow(temp_b, 2) - pow(temp_c, 2)) / 2 / temp_a / temp_b);
//site for turn
const float turn_x1 = (temp_a - length_side) / 2;
const float turn_y1 = y_start + y_step / 2;
const float turn_x0 = turn_x1 - temp_b * cos(temp_alpha);
const float turn_y0 = temp_b * sin(temp_alpha) - turn_y1 - length_side;
/* ---------------------------------------------------------------------------*/
String lastComm = &quot;&quot;;
boolean print_reach = false;
/*
  - wait one of end points move to expect site
  - blocking function
   ---------------------------------------------------------------------------*/
void wait_reach(int leg) &#123;
    while (1)&#123;
        if(print_reach)&#123;
            Serial.printf(&quot;%i now:%f exp:%f\n&quot;, leg, sst.site_now[leg][0], sst.site_expect[leg][0]);
            Serial.printf(&quot;%i now:%f exp:%f\n&quot;, leg, sst.site_now[leg][1], sst.site_expect[leg][1]);
            Serial.printf(&quot;%i now:%f exp:%f\n&quot;, leg, sst.site_now[leg][2], sst.site_expect[leg][2]);
        &#125;
        if (sst.site_now[leg][0] == sst.site_expect[leg][0])&#123;
            if (sst.site_now[leg][1] == sst.site_expect[leg][1])&#123;
                if (sst.site_now[leg][2] == sst.site_expect[leg][2])&#123;
                    break;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;

/*
  - wait all of end points move to expect site
  - blocking function
   ---------------------------------------------------------------------------*/
void wait_all_reach(void) &#123;
    for (int i = 0; i &lt; 4; i++)
        wait_reach(i);
&#125;

// you can use this function if you&#39;d like to set the pulse length in seconds
// e.g. setServoPulse(0, 0.001) is a ~1 millisecond pulse width. its not precise!
void setServoPulse(uint8_t n, double pulse) &#123;
    double pulselength;
    pulselength = 1000000;  // 1,000,000 us per second
    pulselength /= 60;      // 60 Hz
    pulselength /= 4096;    // 12 bits of resolution
    pulse *= 1000000;       // convert to us
    pulse /= pulselength;
    pwm.setPWM(n, 0, pulse);
&#125;

/*
  - set one of end points&#39; expect site
  - this founction will set temp_speed[4][3] at same time
  - non - blocking function
   ---------------------------------------------------------------------------*/
void set_site(int leg, float x, float y, float z) &#123;
    float length_x = 0, length_y = 0, length_z = 0;

    if (x != KEEP)
        length_x = x - sst.site_now[leg][0];
    if (y != KEEP)
        length_y = y - sst.site_now[leg][1];
    if (z != KEEP)
        length_z = z - sst.site_now[leg][2];

    float length = sqrt(pow(length_x, 2) + pow(length_y, 2) + pow(length_z, 2));

    sst.temp_speed[leg][0] = length_x / length * move_speed * speed_multiple;
    sst.temp_speed[leg][1] = length_y / length * move_speed * speed_multiple;
    sst.temp_speed[leg][2] = length_z / length * move_speed * speed_multiple;

    if (x != KEEP)
        sst.site_expect[leg][0] = x;
    if (y != KEEP)
        sst.site_expect[leg][1] = y;
    if (z != KEEP)
        sst.site_expect[leg][2] = z;
&#125;

/*
  - is_stand
   ---------------------------------------------------------------------------*/
bool is_stand(void) &#123;
    if (sst.site_now[0][2] == z_default)
        return true;
    else
        return false;
&#125;

/*
  - sit
  - blocking function
   ---------------------------------------------------------------------------*/
void sit(void) &#123;
    move_speed = stand_seat_speed;
    for (int leg = 0; leg &lt; 4; leg++) &#123;
        set_site(leg, KEEP, KEEP, z_boot);
    &#125;
    wait_all_reach();
    Serial.println(&quot;Body twist right&quot;);
&#125;

/*
  - stand
  - blocking function
   ---------------------------------------------------------------------------*/
void stand(void) &#123;
    move_speed = stand_seat_speed;
    for (int leg = 0; leg &lt; 4; leg++) &#123;
        set_site(leg, KEEP, KEEP, z_default);
    &#125;
    wait_all_reach();
    
&#125;

/*
  - Body init
  - blocking function
   ---------------------------------------------------------------------------*/
void b_init(void) &#123;
    //stand();
    set_site(0, x_default, y_default, z_default);
    set_site(1, x_default, y_default, z_default);
    set_site(2, x_default, y_default, z_default);
    set_site(3, x_default, y_default, z_default);
    wait_all_reach();
    Serial.println(&quot;Body twist right&quot;);
&#125;

/*
  - spot turn to left
  - blocking function
  - parameter step steps wanted to turn
   ---------------------------------------------------------------------------*/
void turn_left(unsigned int step) &#123;
    move_speed = spot_turn_speed;
    while (step-- &gt; 0) &#123;
        if (sst.site_now[3][1] == y_start) &#123;
            //leg 3&amp;1 move
            set_site(3, x_default + x_offset, y_start, z_up);
            wait_all_reach();

            set_site(0, turn_x1 - x_offset, turn_y1, z_default);
            set_site(1, turn_x0 - x_offset, turn_y0, z_default);
            set_site(2, turn_x1 + x_offset, turn_y1, z_default);
            set_site(3, turn_x0 + x_offset, turn_y0, z_up);
            wait_all_reach();

            set_site(3, turn_x0 + x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(0, turn_x1 + x_offset, turn_y1, z_default);
            set_site(1, turn_x0 + x_offset, turn_y0, z_default);
            set_site(2, turn_x1 - x_offset, turn_y1, z_default);
            set_site(3, turn_x0 - x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(1, turn_x0 + x_offset, turn_y0, z_up);
            wait_all_reach();

            set_site(0, x_default + x_offset, y_start, z_default);
            set_site(1, x_default + x_offset, y_start, z_up);
            set_site(2, x_default - x_offset, y_start + y_step, z_default);
            set_site(3, x_default - x_offset, y_start + y_step, z_default);
            wait_all_reach();

            set_site(1, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125; else &#123;
            //leg 0&amp;2 move
            set_site(0, x_default + x_offset, y_start, z_up);
            wait_all_reach();

            set_site(0, turn_x0 + x_offset, turn_y0, z_up);
            set_site(1, turn_x1 + x_offset, turn_y1, z_default);
            set_site(2, turn_x0 - x_offset, turn_y0, z_default);
            set_site(3, turn_x1 - x_offset, turn_y1, z_default);
            wait_all_reach();

            set_site(0, turn_x0 + x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(0, turn_x0 - x_offset, turn_y0, z_default);
            set_site(1, turn_x1 - x_offset, turn_y1, z_default);
            set_site(2, turn_x0 + x_offset, turn_y0, z_default);
            set_site(3, turn_x1 + x_offset, turn_y1, z_default);
            wait_all_reach();

            set_site(2, turn_x0 + x_offset, turn_y0, z_up);
            wait_all_reach();

            set_site(0, x_default - x_offset, y_start + y_step, z_default);
            set_site(1, x_default - x_offset, y_start + y_step, z_default);
            set_site(2, x_default + x_offset, y_start, z_up);
            set_site(3, x_default + x_offset, y_start, z_default);
            wait_all_reach();

            set_site(2, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125;
    &#125;
&#125;

/*
  - spot turn to right
  - blocking function
  - parameter step steps wanted to turn
   ---------------------------------------------------------------------------*/
void turn_right(unsigned int step) &#123;
    move_speed = spot_turn_speed;
    while (step-- &gt; 0) &#123;
        if (sst.site_now[2][1] == y_start) &#123;
            //leg 2&amp;0 move
            set_site(2, x_default + x_offset, y_start, z_up);
            wait_all_reach();

            set_site(0, turn_x0 - x_offset, turn_y0, z_default);
            set_site(1, turn_x1 - x_offset, turn_y1, z_default);
            set_site(2, turn_x0 + x_offset, turn_y0, z_up);
            set_site(3, turn_x1 + x_offset, turn_y1, z_default);
            wait_all_reach();

            set_site(2, turn_x0 + x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(0, turn_x0 + x_offset, turn_y0, z_default);
            set_site(1, turn_x1 + x_offset, turn_y1, z_default);
            set_site(2, turn_x0 - x_offset, turn_y0, z_default);
            set_site(3, turn_x1 - x_offset, turn_y1, z_default);
            wait_all_reach();

            set_site(0, turn_x0 + x_offset, turn_y0, z_up);
            wait_all_reach();

            set_site(0, x_default + x_offset, y_start, z_up);
            set_site(1, x_default + x_offset, y_start, z_default);
            set_site(2, x_default - x_offset, y_start + y_step, z_default);
            set_site(3, x_default - x_offset, y_start + y_step, z_default);
            wait_all_reach();

            set_site(0, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125; else &#123;
            //leg 1&amp;3 move
            set_site(1, x_default + x_offset, y_start, z_up);
            wait_all_reach();

            set_site(0, turn_x1 + x_offset, turn_y1, z_default);
            set_site(1, turn_x0 + x_offset, turn_y0, z_up);
            set_site(2, turn_x1 - x_offset, turn_y1, z_default);
            set_site(3, turn_x0 - x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(1, turn_x0 + x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(0, turn_x1 - x_offset, turn_y1, z_default);
            set_site(1, turn_x0 - x_offset, turn_y0, z_default);
            set_site(2, turn_x1 + x_offset, turn_y1, z_default);
            set_site(3, turn_x0 + x_offset, turn_y0, z_default);
            wait_all_reach();

            set_site(3, turn_x0 + x_offset, turn_y0, z_up);
            wait_all_reach();

            set_site(0, x_default - x_offset, y_start + y_step, z_default);
            set_site(1, x_default - x_offset, y_start + y_step, z_default);
            set_site(2, x_default + x_offset, y_start, z_default);
            set_site(3, x_default + x_offset, y_start, z_up);
            wait_all_reach();

            set_site(3, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125;
    &#125;
&#125;

/*
  - go forward
  - blocking function
  - parameter step steps wanted to go
   ---------------------------------------------------------------------------*/
void step_forward(unsigned int step) &#123;
    move_speed = leg_move_speed;
    while (step-- &gt; 0) &#123;
        if (sst.site_now[2][1] == y_start) &#123;
            //leg 2&amp;1 move
            set_site(2, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(2, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(2, x_default + x_offset, y_start + 2 * y_step, z_default);
            wait_all_reach();

            move_speed = body_move_speed;

            set_site(0, x_default + x_offset, y_start, z_default);
            set_site(1, x_default + x_offset, y_start + 2 * y_step, z_default);
            set_site(2, x_default - x_offset, y_start + y_step, z_default);
            set_site(3, x_default - x_offset, y_start + y_step, z_default);
            wait_all_reach();

            move_speed = leg_move_speed;

            set_site(1, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(1, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(1, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125; else &#123;
            //      leg 0&amp;3 move
            set_site(0, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(0, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(0, x_default + x_offset, y_start + 2 * y_step, z_default);
            wait_all_reach();

            move_speed = body_move_speed;

            set_site(0, x_default - x_offset, y_start + y_step, z_default);
            set_site(1, x_default - x_offset, y_start + y_step, z_default);
            set_site(2, x_default + x_offset, y_start, z_default);
            set_site(3, x_default + x_offset, y_start + 2 * y_step, z_default);
            wait_all_reach();

            move_speed = leg_move_speed;

            set_site(3, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(3, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(3, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125;
    &#125;
&#125;

/*
  - go back
  - blocking function
  - parameter step steps wanted to go
   ---------------------------------------------------------------------------*/
void step_back(unsigned int step) &#123;
    move_speed = leg_move_speed;
    while (step-- &gt; 0) &#123;
        if (sst.site_now[3][1] == y_start) &#123;
            //leg 3&amp;0 move
            set_site(3, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(3, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(3, x_default + x_offset, y_start + 2 * y_step, z_default);
            wait_all_reach();

            move_speed = body_move_speed;

            set_site(0, x_default + x_offset, y_start + 2 * y_step, z_default);
            set_site(1, x_default + x_offset, y_start, z_default);
            set_site(2, x_default - x_offset, y_start + y_step, z_default);
            set_site(3, x_default - x_offset, y_start + y_step, z_default);
            wait_all_reach();

            move_speed = leg_move_speed;

            set_site(0, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(0, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(0, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125; else &#123;
            //leg 1&amp;2 move
            set_site(1, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(1, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(1, x_default + x_offset, y_start + 2 * y_step, z_default);
            wait_all_reach();

            move_speed = body_move_speed;

            set_site(0, x_default - x_offset, y_start + y_step, z_default);
            set_site(1, x_default - x_offset, y_start + y_step, z_default);
            set_site(2, x_default + x_offset, y_start + 2 * y_step, z_default);
            set_site(3, x_default + x_offset, y_start, z_default);
            wait_all_reach();

            move_speed = leg_move_speed;

            set_site(2, x_default + x_offset, y_start + 2 * y_step, z_up);
            wait_all_reach();
            set_site(2, x_default + x_offset, y_start, z_up);
            wait_all_reach();
            set_site(2, x_default + x_offset, y_start, z_default);
            wait_all_reach();
        &#125;
    &#125;
&#125;

// add by RegisHsu

void body_left(int i) &#123;
    set_site(0, sst.site_now[0][0] + i, KEEP, KEEP);
    set_site(1, sst.site_now[1][0] + i, KEEP, KEEP);
    set_site(2, sst.site_now[2][0] - i, KEEP, KEEP);
    set_site(3, sst.site_now[3][0] - i, KEEP, KEEP);
    wait_all_reach();
&#125;

void body_right(int i) &#123;
    set_site(0, sst.site_now[0][0] - i, KEEP, KEEP);
    set_site(1, sst.site_now[1][0] - i, KEEP, KEEP);
    set_site(2, sst.site_now[2][0] + i, KEEP, KEEP);
    set_site(3, sst.site_now[3][0] + i, KEEP, KEEP);
    wait_all_reach();
&#125;

void hand_wave(int i) &#123;
    float x_tmp;
    float y_tmp;
    float z_tmp;
    move_speed = 1;
    if (sst.site_now[3][1] == y_start) &#123;
        body_right(15);
        x_tmp = sst.site_now[2][0];
        y_tmp = sst.site_now[2][1];
        z_tmp = sst.site_now[2][2];
        move_speed = body_move_speed;
        for (int j = 0; j &lt; i; j++) &#123;
            set_site(2, turn_x1, turn_y1, 50);
            wait_all_reach();
            set_site(2, turn_x0, turn_y0, 50);
            wait_all_reach();
        &#125;
        set_site(2, x_tmp, y_tmp, z_tmp);
        wait_all_reach();
        move_speed = 1;
        body_left(15);
    &#125; else &#123;
        body_left(15);
        x_tmp = sst.site_now[0][0];
        y_tmp = sst.site_now[0][1];
        z_tmp = sst.site_now[0][2];
        move_speed = body_move_speed;
        for (int j = 0; j &lt; i; j++) &#123;
            set_site(0, turn_x1, turn_y1, 50);
            wait_all_reach();
            set_site(0, turn_x0, turn_y0, 50);
            wait_all_reach();
        &#125;
        set_site(0, x_tmp, y_tmp, z_tmp);
        wait_all_reach();
        move_speed = 1;
        body_right(15);
    &#125;
&#125;

void hand_shake(int i) &#123;
    float x_tmp;
    float y_tmp;
    float z_tmp;
    move_speed = 1;
    if (sst.site_now[3][1] == y_start) &#123;
        body_right(15);
        x_tmp = sst.site_now[2][0];
        y_tmp = sst.site_now[2][1];
        z_tmp = sst.site_now[2][2];
        move_speed = body_move_speed;
        for (int j = 0; j &lt; i; j++) &#123;
            set_site(2, x_default - 30, y_start + 2 * y_step, 55);
            wait_all_reach();
            set_site(2, x_default - 30, y_start + 2 * y_step, 10);
            wait_all_reach();
        &#125;
        set_site(2, x_tmp, y_tmp, z_tmp);
        wait_all_reach();
        move_speed = 1;
        body_left(15);
    &#125; else &#123;
        body_left(15);
        x_tmp = sst.site_now[0][0];
        y_tmp = sst.site_now[0][1];
        z_tmp = sst.site_now[0][2];
        move_speed = body_move_speed;
        for (int j = 0; j &lt; i; j++) &#123;
            set_site(0, x_default - 30, y_start + 2 * y_step, 55);
            wait_all_reach();
            set_site(0, x_default - 30, y_start + 2 * y_step, 10);
            wait_all_reach();
        &#125;
        set_site(0, x_tmp, y_tmp, z_tmp);
        wait_all_reach();
        move_speed = 1;
        body_right(15);
    &#125;
&#125;

void head_up(int i) &#123;
    set_site(0, KEEP, KEEP, sst.site_now[0][2] - i);
    set_site(1, KEEP, KEEP, sst.site_now[1][2] + i);
    set_site(2, KEEP, KEEP, sst.site_now[2][2] - i);
    set_site(3, KEEP, KEEP, sst.site_now[3][2] + i);
    wait_all_reach();
&#125;

void head_down(int i) &#123;
    set_site(0, KEEP, KEEP, sst.site_now[0][2] + i);
    set_site(1, KEEP, KEEP, sst.site_now[1][2] - i);
    set_site(2, KEEP, KEEP, sst.site_now[2][2] + i);
    set_site(3, KEEP, KEEP, sst.site_now[3][2] - i);
    wait_all_reach();
&#125;

void body_dance(int i) &#123;
    float body_dance_speed = 2;
    sit();
    move_speed = 1;
    set_site(0, x_default, y_default, KEEP);
    set_site(1, x_default, y_default, KEEP);
    set_site(2, x_default, y_default, KEEP);
    set_site(3, x_default, y_default, KEEP);
    print_reach = true;
    wait_all_reach();
    stand();
    set_site(0, x_default, y_default, z_default - 20);
    set_site(1, x_default, y_default, z_default - 20);
    set_site(2, x_default, y_default, z_default - 20);
    set_site(3, x_default, y_default, z_default - 20);
    wait_all_reach();
    move_speed = body_dance_speed;
    head_up(30);
    for (int j = 0; j &lt; i; j++) &#123;
        if (j &gt; i / 4)
            move_speed = body_dance_speed * 2;
        if (j &gt; i / 2)
            move_speed = body_dance_speed * 3;
        set_site(0, KEEP, y_default - 20, KEEP);
        set_site(1, KEEP, y_default + 20, KEEP);
        set_site(2, KEEP, y_default - 20, KEEP);
        set_site(3, KEEP, y_default + 20, KEEP);
        wait_all_reach();
        set_site(0, KEEP, y_default + 20, KEEP);
        set_site(1, KEEP, y_default - 20, KEEP);
        set_site(2, KEEP, y_default + 20, KEEP);
        set_site(3, KEEP, y_default - 20, KEEP);
        wait_all_reach();
    &#125;
    move_speed = body_dance_speed;
    head_down(30);
    b_init();
&#125;

// This gets set as the default handler, and gets called when no other command matches.
void unrecognized(const char *command) &#123;
    Serial.println(&quot;What?&quot;);
&#125;


void action_cmd (void) &#123;
    char val;
    int  n_step=1; //这里设置默认每次1步
    val = SerialBT.read();
    servos_cmd (val, n_step);
&#125;


void servos_cmd(int action_mode, int n_step) &#123;

    switch (action_mode) &#123;
        case &#39;0&#39;:
            Serial.println(&quot;Step forward&quot;);

            SerialBT.println(&quot;forward&quot;);

            if (!is_stand())
                stand();
            step_forward(n_step);
            break;

        case &#39;1&#39;:
            Serial.println(&quot;Step back&quot;);

            SerialBT.println(&quot;backward&quot;);

            if (!is_stand())
                stand();
            step_back(n_step);
            break;

        case &#39;2&#39;:
            Serial.println(&quot;Turn left&quot;);

            SerialBT.println(&quot;turn left&quot;);

           
            if (!is_stand())
                stand();
            turn_left(n_step);
            break;

        case &#39;3&#39;:
            Serial.println(&quot;Turn right&quot;);

            SerialBT.println(&quot;turn right&quot;);

            if (!is_stand())
                stand();
            turn_right(n_step);
            break;

        case &#39;4&#39;:
            Serial.println(&quot;1:up,0:dn&quot;);

            SerialBT.println(&quot; sit&quot;);

          
                sit();
            break;

        case &#39;5&#39;:
            Serial.println(&quot;Hand shake&quot;);

            SerialBT.println(&quot;hand shake&quot;);

            hand_shake(n_step);
            break;

        case &#39;6&#39;:
            Serial.println(&quot;Hand wave&quot;);

            SerialBT.println(&quot;hand wave&quot;);

            hand_wave(n_step);
            break;

        case &#39;7&#39;:
            Serial.println(&quot;Lets rock baby&quot;);

            SerialBT.println(&quot;dance&quot;);

            body_dance(10);
            break;

        case &#39;8&#39;:
            Serial.println(&quot;Reset&quot;);

            sst.FLElbow = 0;
            sst.FRElbow = 0;
            sst.RLElbow = 0;
            sst.RRElbow = 0;
            sst.FLFoot = 0;
            sst.FRFoot = 0;
            sst.RLFoot = 0;
            sst.RRFoot = 0;
            sst.FLShdr = 0;
            sst.FRShdr = 0;
            sst.RLShdr = 0;
            sst.RRShdr = 0;
            stand();
            break;

        case &#39;9&#39;:
            Serial.println(&quot;Higher&quot;);

            SerialBT.println(&quot;higher&quot;);

            sst.FLElbow -= 4;
            sst.FRElbow -= 4;
            sst.RLElbow -= 4;
            sst.RRElbow -= 4;
            sst.FLFoot += 4;
            sst.FRFoot += 4;
            sst.RLFoot += 4;
            sst.RRFoot += 4;
            stand();
            break;

        case &#39;10&#39;:
            Serial.println(&quot;Lower&quot;);

            SerialBT.println(&quot;lower&quot;);

            sst.FLElbow += 4;
            sst.FRElbow += 4;
            sst.RLElbow += 4;
            sst.RRElbow += 4;
            sst.FLFoot -= 4;
            sst.FRFoot -= 4;
            sst.RLFoot -= 4;
            sst.RRFoot -= 4;
            stand();
            break;

        case W_HEAD_UP:
            Serial.println(&quot;Head up&quot;);

            SerialBT.println(&quot;head up&quot;);

            sst.FLElbow -= 4;
            sst.FRElbow -= 4;
            sst.RLElbow += 4;
            sst.RRElbow += 4;
            sst.FLFoot += 4;
            sst.FRFoot += 4;
            sst.RLFoot -= 4;
            sst.RRFoot -= 4;
            stand();
            break;

        case W_HEAD_DOWN:
            Serial.println(&quot;Head down&quot;);

            SerialBT.println(&quot;head down&quot;);

            sst.FLElbow += 4;
            sst.FRElbow += 4;
            sst.RLElbow -= 4;
            sst.RRElbow -= 4;
            sst.FLFoot -= 4;
            sst.FRFoot -= 4;
            sst.RLFoot += 4;
            sst.RRFoot += 4;
            stand();
            break;

        case W_B_RIGHT:
            Serial.println(&quot;body right&quot;);

            SerialBT.println(&quot;body right&quot;);

            if (!is_stand()) stand();
            sst.FLElbow -= 4;
            sst.FRElbow += 4;
            sst.RLElbow -= 4;
            sst.RRElbow += 4;
            sst.FLFoot += 4;
            sst.FRFoot -= 4;
            sst.RLFoot += 4;
            sst.RRFoot -= 4;
            stand();
            break;

        case W_B_LEFT:
            Serial.println(&quot;body left&quot;);

            SerialBT.println(&quot;body left&quot;);

            if (!is_stand()) stand();
            sst.FLElbow += 4;
            sst.FRElbow -= 4;
            sst.RLElbow += 4;
            sst.RRElbow -= 4;
            sst.FLFoot -= 4;
            sst.FRFoot += 4;
            sst.RLFoot -= 4;
            sst.RRFoot += 4;
            stand();
            break;

        case W_B_INIT:
            Serial.println(&quot;Body init&quot;);

            SerialBT.println(&quot;body init&quot;);

            sit();
            b_init();
            sst.FLElbow = 0;
            sst.FRElbow = 0;
            sst.RLElbow = 0;
            sst.RRElbow = 0;
            sst.FLFoot = 0;
            sst.FRFoot = 0;
            sst.RLFoot = 0;
            sst.RRFoot = 0;
            sst.FLShdr = 0;
            sst.FRShdr = 0;
            sst.RLShdr = 0;
            sst.RRShdr = 0;
            stand();
            break;

        case W_TW_R:
            Serial.println(&quot;Body twist right&quot;);

            SerialBT.println(&quot;twist right&quot;);

            sst.FLShdr -= 4;
            sst.FRShdr += 4;
            sst.RLShdr += 4;
            sst.RRShdr -= 4;
            stand();
            break;

        case W_TW_L:
            Serial.println(&quot;Body twist left&quot;);

            SerialBT.println(&quot;twist left&quot;);

            sst.FLShdr += 4;
            sst.FRShdr -= 4;
            sst.RLShdr -= 4;
            sst.RRShdr += 4;
            stand();
            break;

        default:
            Serial.println(&quot;Error&quot;);

            SerialBT.println(&quot;error&quot;);

            break;
    &#125;
&#125;

/*
  - trans site from cartesian to polar
  - mathematical model 2/2
   ---------------------------------------------------------------------------*/
void cartesian_to_polar(float &amp;alpha, float &amp;beta, float &amp;gamma, float x, float y, float z) &#123;
    //calculate w-z degree
    float v, w;
    w = (x &gt;= 0 ? 1 : -1) * (sqrt(pow(x, 2) + pow(y, 2)));
    v = w - length_c;
    alpha = atan2(z, v) + acos((pow(length_a, 2) - pow(length_b, 2) + pow(v, 2) + pow(z, 2)) / 2 / length_a / sqrt(pow(v, 2) + pow(z, 2)));
    beta = acos((pow(length_a, 2) + pow(length_b, 2) - pow(v, 2) - pow(z, 2)) / 2 / length_a / length_b);
    //calculate x-y-z degree
    gamma = (w &gt;= 0) ? atan2(y, x) : atan2(-y, -x);
    //trans degree pi-&gt;180
    alpha = alpha / pi * 180.0;
    beta = beta / pi * 180.0;
    gamma = gamma / pi * 180.0;
&#125;

void print_final_PWM (int pin, uint16_t off)&#123;
#ifdef TIMER_INTERRUPT_DEBUG
    Serial.printf(&quot;[PWM]\tP:%i\toff:%u\n&quot;,pin,off);
#endif
&#125;

/*
  - trans site from polar to microservos
  - mathematical model map to fact
  - the errors saved in eeprom will be add
   ---------------------------------------------------------------------------*/
void polar_to_servo(int leg, float alpha, float beta, float gamma) &#123;
    if (leg == 0)  //Front Right
    &#123;
        alpha = 85 - alpha - sst.FRElbow;  //elbow (- is up)
        beta = beta + 40 - sst.FRFoot;     //foot (- is up)
        gamma += 115 - sst.FRShdr;         // shoulder (- is left)
    &#125; else if (leg == 1)               //Rear Right
    &#123;
        alpha += 90 + sst.RRElbow;         //elbow (+ is up)
        beta = 115 - beta + sst.RRFoot;    //foot (+ is up)
        gamma = 115 - gamma + sst.RRShdr;  // shoulder (+ is left)
    &#125; else if (leg == 2)               //Front Left
    &#123;
        alpha += 75 + sst.FLElbow;         //elbow (+ is up)
        beta = 140 - beta + sst.FLFoot;    //foot (+ is up)
        gamma = 115 - gamma + sst.FLShdr;  // shoulder (+ is left)
    &#125; else if (leg == 3)               // Rear Left
    &#123;
        alpha = 90 - alpha - sst.RLElbow;  //elbow (- is up)
        beta = beta + 50 - sst.RLFoot;     //foot; (- is up)
        gamma += 100 - sst.RLShdr;         // shoulder (- is left)
    &#125;

    int AL = ((850 / 180) * alpha);
    if (AL &gt; 580) AL = 580;
    if (AL &lt; 125) AL = 125;
    print_final_PWM(servo_pin[leg][0], AL);
    pwm.setPWM(servo_pin[leg][0], 0, AL);
    int BE = ((850 / 180) * beta);
    if (BE &gt; 580) BE = 580;
    if (BE &lt; 125) BE = 125;
    print_final_PWM(servo_pin[leg][1], BE);
    pwm.setPWM(servo_pin[leg][1], 0, BE);
    int GA = ((580 / 180) * gamma);
    if (GA &gt; 580) GA = 580;
    if (GA &lt; 125) GA = 125;
    print_final_PWM(servo_pin[leg][2], GA);
    pwm.setPWM(servo_pin[leg][2], 0, GA);
&#125;

SemaphoreHandle_t Semaphore;

void servos_service(void * data) &#123;
    // service_status_t sst = *(service_status_t *)data;
    for (;;) &#123;
        float alpha, beta, gamma;
        xSemaphoreTake(Semaphore, portMAX_DELAY);
        for (int i = 0; i &lt; 4; i++) &#123;
            for (int j = 0; j &lt; 3; j++) &#123;
                if (abs(sst.site_now[i][j] - sst.site_expect[i][j]) &gt;= abs(sst.temp_speed[i][j]))
                    sst.site_now[i][j] += sst.temp_speed[i][j];
                else
                    sst.site_now[i][j] = sst.site_expect[i][j];
            &#125;
            cartesian_to_polar(alpha, beta, gamma, sst.site_now[i][0], sst.site_now[i][1], sst.site_now[i][2]);
            polar_to_servo(i, alpha, beta, gamma);
        &#125;
        sst.rest_counter++;
        xSemaphoreGive(Semaphore);
        vTaskDelay(10 / portTICK_PERIOD_MS);
        
#ifdef TIMER_INTERRUPT_DEBUG
        Serial.printf(&quot;%05lu counter: %lu\n&quot;,(unsigned long)millis(),(unsigned long)sst.rest_counter);
        Serial.printf(&quot;[OUT]\tA:%f\tB:%f\tG:%f\n&quot;,alpha, beta, gamma);
#endif
    &#125;
&#125;





void servos_start() &#123;
    sit();
    b_init();
&#125;

TaskHandle_t Task0;

void servos_init() &#123;   //定义舵机服务
    // Options are: 240 (default), 160, 80, 40, 20 and 10 MHz
    setCpuFrequencyMhz(80);   //设置单片机核心运行速度
    int cpuSpeed = getCpuFrequencyMhz();
    Serial.println(&quot;CPU Running at &quot; + String(cpuSpeed) + &quot;MHz&quot;);
    Serial.println(&quot;starting PWM Library..&quot;);
    Wire.begin(SDA_PIN,SCL_PIN);
    pwm.begin();
    pwm.setPWMFreq(60);  // Analog servos ru n at ~60 Hz updates
    //initialize default parameter
    Serial.println(&quot;servo parameters:&quot;);
    set_site(2, x_default - x_offset, y_start + y_step, z_boot);
    set_site(3, x_default - x_offset, y_start + y_step, z_boot);
    set_site(0, x_default + x_offset, y_start, z_boot);
    set_site(1, x_default + x_offset, y_start, z_boot);
    Serial.printf(&quot;X:%f\tY:%f\tZ:%f\n&quot;,x_default,y_start,z_boot);
    for (int i = 0; i &lt; 4; i++) &#123;
        for (int j = 0; j &lt; 3; j++) &#123;
            sst.site_now[i][j] = sst.site_expect[i][j];
        &#125;
    &#125;
    Serial.println(&quot;starting servos service..&quot;);
    // Semafor only for service writing
    Semaphore = xSemaphoreCreateMutex();

    xTaskCreatePinnedToCore(
        servos_service,   // Function that should be called
        &quot;ServoService&quot;,  // Name of the task (for debugging)
        10000,          // Stack size (bytes)
        (void *)&amp;sst,    // Parameter to pass
        1,               // Task priority
        &amp;Task0,          // Task handle
        1
        );

    //initialize servos
    servos_start();
    Serial.println(&quot;Servos initialized.&quot;);

    Serial.println(&quot;Starting Bluetooth Library..&quot;);
   
    SerialBT.begin(&quot;ESP32test&quot;);
    Serial.println(&quot;BT Serial ready&quot;);
    Serial.println(&quot;Robot initialization Complete&quot;);
&#125;

uint32_t ledPulse = 0;
uint32_t ledSpeed = LED_SPEED;

void servos_loop() &#123;

    //-----------led blink status
    /*
    if (ledPulse &lt;= ledSpeed) &#123;
        digitalWrite(LED_BUILTIN, HIGH);
    &#125;
    if (ledPulse &gt; ledSpeed*3) &#123;
        digitalWrite(LED_BUILTIN, LOW);
    &#125;
    if (ledPulse &gt;= ledSpeed*4) &#123;
        ledPulse = 0;

        if (SerialBT.hasClient()) ledSpeed = LED_SPEED*3;
        else ledSpeed = LED_SPEED;

    &#125;

    ledPulse++;
    */
    if (SerialBT.available()) &#123;
   action_cmd();&#125;
   

#ifdef TIMER_INTERRUPT_DEBUG
    Serial.printf(&quot;%05lu loop counter: %lu\n&quot;,(unsigned long)millis(),(unsigned long)sst.rest_counter);
#endif

&#125;
</code></pre>
<p><strong>🧡h文件</strong></p>
<pre><code>#include &lt;Wire.h&gt;
#include &lt;Adafruit_PWMServoDriver.h&gt;
#include &lt;BluetoothSerial.h&gt;


#define SDA_PIN 21
#define SCL_PIN 22
#define LED_BUILTIN 2
#define LED_SPEED 30

#define W_STAND_SIT    0
#define W_FORWARD      1
#define W_BACKWARD     2
#define W_LEFT         3
#define W_RIGHT        4
#define W_SHAKE        5
#define W_WAVE         6
#define W_DANCE        7
#define W_HEAD_UP      8
#define W_HEAD_DOWN    9
#define W_B_RIGHT      10
#define W_B_LEFT       11
#define W_B_INIT       12
#define W_HIGHER       13
#define W_LOWER        14
#define W_SET          15
#define W_TW_R         16
#define W_TW_L         17

void servos_init(void);
void servos_loop(void);
void servos_cmd(int action_mode, int n_step);

// w 0 2: body init        原来的蓝牙控制
// w 0 1: stand
// w 0 0: sit
// w 1 x: forward x step
// w 2 x: back x step
// w 3 x: right turn x step
// w 4 x: left turn x step
// w 5 x: hand shake x times
// w 6 x: hand wave x times
// w 7 : dance
// w 8 x: head up x times
// w 9 x: head down x times
// w 10 x: body right x times
// w 11 x: body left x times
// w 12: Body init pose
// w 13: body up
// w 14: body down
// w 15: reset pos
// w 16: body twist right
// w 17: body twist left
</code></pre>
<hr>
<h2 id="5️⃣总结"><a href="#5️⃣总结" class="headerlink" title="5️⃣总结"></a>5️⃣总结</h2><p>🎈🎈🎈项目在大一寒假时开始，当时还是个萌新（现在也是），误操作烧坏了两个舵机，进度搁置。尝试用过esp32的扩展板代替16路舵机驱动板，但缺乏电路知识，扩展版最大支持1a电流，最终含泪看着电源芯片冒烟，单片机烧坏😥<br>暑假重新开始这个项目，结合github的开源项目，最终成功尝试成功！！！！<br>最后码上测试时候的视频🤗</p>
<iframe src="https://live.csdn.net/v/embed/229189" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%"  height="580" quality="high" > </iframe>




        </article>

        
            
  <div class="nexmoe-post-copyright">
    <strong>本文作者：</strong>Maimaijun<br>
    
    <strong>本文链接：</strong><a href="http://example.com/2022/08/24/test/" title="http:&#x2F;&#x2F;example.com&#x2F;2022&#x2F;08&#x2F;24&#x2F;test&#x2F;" target="_blank" rel="noopener">http:&#x2F;&#x2F;example.com&#x2F;2022&#x2F;08&#x2F;24&#x2F;test&#x2F;</a><br>

    
      <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
    
  </div>


        

        <div class="nexmoe-post-meta nexmoe-rainbow">
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/EPS32/" rel="tag">EPS32</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" rel="tag">单片机</a>
    
</div>

    <div class="nexmoe-post-footer">
        <section class="nexmoe-comment">
    <div class="valine"></div>
<script src="https://unpkg.com/leancloud-storage/dist/av-min.js"></script>
<script src='https://unpkg.com/valine@1.3.9/dist/Valine.min.js'></script>
<script>
    // 使用方法 https://valine.js.org/quickstart.html
    new Valine({
        el: '.valine',
        appId: 'U6Ugwu9lXMAfB7QD3qeHRFCB-gzGzoHsz',
        appKey: '2IkYYVX5XI95SyfJuaWr05e5'
    })
</script>
</section>
    </div>
</div>


        <div class="nexmoe-post-right">
          
            <div class="nexmoe-fixed">
              <div class="nexmoe-tool">
                <a href="#" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
              </div>
            </div>
          
        </div>
    </div>
  </div>
  <div id="nexmoe-pendant">
    <div class="nexmoe-drawer mdui-drawer nexmoe-pd" id="drawer">
        
            <div class="nexmoe-pd-item">
                <div class="clock">
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="memory"></div>
        <div class="needle" id="hours"></div>
        <div class="needle" id="minutes"></div>
        <div class="needle" id="seconds"></div>
        <div class="clock_logo">

        </div>

    </div>
<style>
    .clock {
        background-color: #ffffff;
        width: 70vw;
        height: 70vw;
        max-width: 70vh;
        max-height: 70vh;
        border: solid 2.8vw #242424;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
        box-sizing: border-box;
        box-shadow: 0 1.4vw 2.8vw rgba(0, 0, 0, 0.8);
        zoom:0.2
    }

    .memory {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .memory:nth-child(1) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(0deg) translateY(-520%);
    }

    .memory:nth-child(2) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(6deg) translateY(-1461%);
    }

    .memory:nth-child(3) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(12deg) translateY(-1461%);
    }

    .memory:nth-child(4) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(18deg) translateY(-1461%);
    }

    .memory:nth-child(5) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(24deg) translateY(-1461%);
    }

    .memory:nth-child(6) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(30deg) translateY(-520%);
    }

    .memory:nth-child(7) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(36deg) translateY(-1461%);
    }

    .memory:nth-child(8) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(42deg) translateY(-1461%);
    }

    .memory:nth-child(9) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(48deg) translateY(-1461%);
    }

    .memory:nth-child(10) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(54deg) translateY(-1461%);
    }

    .memory:nth-child(11) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(60deg) translateY(-520%);
    }

    .memory:nth-child(12) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(66deg) translateY(-1461%);
    }

    .memory:nth-child(13) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(72deg) translateY(-1461%);
    }

    .memory:nth-child(14) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(78deg) translateY(-1461%);
    }

    .memory:nth-child(15) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(84deg) translateY(-1461%);
    }

    .memory:nth-child(16) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(90deg) translateY(-520%);
    }

    .memory:nth-child(17) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(96deg) translateY(-1461%);
    }

    .memory:nth-child(18) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(102deg) translateY(-1461%);
    }

    .memory:nth-child(19) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(108deg) translateY(-1461%);
    }

    .memory:nth-child(20) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(114deg) translateY(-1461%);
    }

    .memory:nth-child(21) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(120deg) translateY(-520%);
    }

    .memory:nth-child(22) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(126deg) translateY(-1461%);
    }

    .memory:nth-child(23) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(132deg) translateY(-1461%);
    }

    .memory:nth-child(24) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(138deg) translateY(-1461%);
    }

    .memory:nth-child(25) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(144deg) translateY(-1461%);
    }

    .memory:nth-child(26) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(150deg) translateY(-520%);
    }

    .memory:nth-child(27) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(156deg) translateY(-1461%);
    }

    .memory:nth-child(28) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(162deg) translateY(-1461%);
    }

    .memory:nth-child(29) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(168deg) translateY(-1461%);
    }

    .memory:nth-child(30) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(174deg) translateY(-1461%);
    }

    .memory:nth-child(31) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(180deg) translateY(-520%);
    }

    .memory:nth-child(32) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(186deg) translateY(-1461%);
    }

    .memory:nth-child(33) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(192deg) translateY(-1461%);
    }

    .memory:nth-child(34) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(198deg) translateY(-1461%);
    }

    .memory:nth-child(35) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(204deg) translateY(-1461%);
    }

    .memory:nth-child(36) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(210deg) translateY(-520%);
    }

    .memory:nth-child(37) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(216deg) translateY(-1461%);
    }

    .memory:nth-child(38) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(222deg) translateY(-1461%);
    }

    .memory:nth-child(39) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(228deg) translateY(-1461%);
    }

    .memory:nth-child(40) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(234deg) translateY(-1461%);
    }

    .memory:nth-child(41) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(240deg) translateY(-520%);
    }

    .memory:nth-child(42) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(246deg) translateY(-1461%);
    }

    .memory:nth-child(43) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(252deg) translateY(-1461%);
    }

    .memory:nth-child(44) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(258deg) translateY(-1461%);
    }

    .memory:nth-child(45) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(264deg) translateY(-1461%);
    }

    .memory:nth-child(46) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(270deg) translateY(-520%);
    }

    .memory:nth-child(47) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(276deg) translateY(-1461%);
    }

    .memory:nth-child(48) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(282deg) translateY(-1461%);
    }

    .memory:nth-child(49) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(288deg) translateY(-1461%);
    }

    .memory:nth-child(50) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(294deg) translateY(-1461%);
    }

    .memory:nth-child(51) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(300deg) translateY(-520%);
    }

    .memory:nth-child(52) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(306deg) translateY(-1461%);
    }

    .memory:nth-child(53) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(312deg) translateY(-1461%);
    }

    .memory:nth-child(54) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(318deg) translateY(-1461%);
    }

    .memory:nth-child(55) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(324deg) translateY(-1461%);
    }

    .memory:nth-child(56) {
        background-color: #424242;
        width: 2%;
        height: 8%;
        transform: translate(-50%, -50%) rotate(330deg) translateY(-520%);
    }

    .memory:nth-child(57) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(336deg) translateY(-1461%);
    }

    .memory:nth-child(58) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(342deg) translateY(-1461%);
    }

    .memory:nth-child(59) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(348deg) translateY(-1461%);
    }

    .memory:nth-child(60) {
        background-color: #949494;
        width: 1%;
        height: 3%;
        transform: translate(-50%, -50%) rotate(354deg) translateY(-1461%);
    }

    .needle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform-origin: center;
    }

    .needle#hours {
        background-color: #1f1f1f;
        width: 4%;
        height: 30%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#hours.moving {
        transition: transform 150ms ease-out;
    }

    .needle#hours:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#minutes {
        background-color: #1f1f1f;
        width: 2%;
        height: 45%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#minutes.moving {
        transition: transform 150ms ease-out;
    }

    .needle#minutes:after {
        content: '';
        background-color: #1f1f1f;
        width: 4vw;
        height: 4vw;
        max-width: 4vh;
        max-height: 4vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }

    .needle#seconds {
        background-color: #cb2f2f;
        width: 1%;
        height: 50%;
        transform-origin: center 75%;
        transform: translate(-50%, -75%);
    }

    .needle#seconds.moving {
        transition: transform 150ms ease-out;
    }

    .needle#seconds:after {
        content: '';
        background-color: #cb2f2f;
        width: 2.5vw;
        height: 2.5vw;
        max-width: 2.5vh;
        max-height: 2.5vh;
        display: block;
        position: absolute;
        top: 75%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
    }
    .clock_logo{
        width: 10vw;
        height: 10vw;
        max-width: 10vh;
        max-height: 10vh;
        position: absolute;
        top: 50%;
        left: 50%;
        box-sizing: border-box;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    @media (min-width: 100vh) {
        .clock {
            border: solid 2.8vh #242424;
            box-shadow: 0 1.4vh 2.8vh rgba(0, 0, 0, 0.8);
        }
    }

</style>





            </div>
        
</div>
<style>
    .nexmoe-pd {
        left: auto;
        top: 40px;
        right: 0;
    }
    .nexmoe-pd-item{
       display: flex;
        justify-content: center;
        margin-bottom: 30px;
    }
</style>

  </div>
  <script src="https://unpkg.com/lazysizes@5.1.0/lazysizes.min.js"></script>
<script src="https://cdn.staticfile.org/highlight.js/10.0.0/highlight.min.js"></script>
<script src="https://unpkg.com/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>

<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://unpkg.com/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="/lib/fancybox/js/jquery.fancybox.min.js"></script>


<script src="/js/app.js?v=1661351491268"></script>

<script src="https://unpkg.com/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





<!-- hexo injector body_end start -->
<script src="/js/clock.js"></script>

<script src="https://unpkg.com/clipboard@2.0.8/dist/clipboard.min.js"></script>

<script src="/lib/codeBlock/codeBlockFuction.js"></script>

<script src="/lib/codeBlock/codeLang.js"></script>

<script src="/lib/codeBlock/codeCopy.js"></script>

<script src="/lib/codeBlock/codeShrink.js"></script>

<link rel="stylesheet" href="/lib/codeBlock/matery.css">

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>

<script src="/js/search.js"></script>

<script src="/js/webapp.js"></script>
<!-- hexo injector body_end end --></body>
</html>

<script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/360b395f.js","daovoice")</script>
<script>
  daovoice('init', {
    app_id: "360b395f"
  });
  daovoice('update');
</script>

